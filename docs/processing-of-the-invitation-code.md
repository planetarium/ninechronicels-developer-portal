
# 초대(활성화) 코드의 처리 과정

# 구조

```jsx
a9811a4b51da78872b47257e404c8a70095482110a1fdc6ab3e5cc57f7c28676/622630ac8a889dcec746ba319c4e7faca607f9eb
```

- 위와 같은 초대 코드가 있을 때 `/` 의 뒷부분이 주소, 앞 부분이 private key입니다.
- 주소는 대기 활성화 코드의 공개 키와 논스를 가리킵니다.

# 활성화 과정

> 📢 본 문서는 사용자와 런처 과정에서 활성화 코드가 사용되는 과정을 기술합니다. 기술적 상세는 참고 자료와 [소스 코드](https://github.com/planetarium/lib9c/blob/development/Lib9c/Action/ActivateAccount.cs)를 참조해 주세요.

## 계정 생성 중 초대 코드의 입력

- 계정 생성 중에 입력되는 초대 코드는 런처의 전역 상태에 잠시 저장됩니다.
    - 실제로 이 과정에서 활성화가 이루어지지 않음에 유의해야 합니다.

## 로비 화면에서의 활성화

- 프리로드가 끝난 후 이 과정에서 로그인에 사용된 사용자의 계정이 활성화되었는지 확인합니다.
    - 활성화된 경우 이 플로우는 종료됩니다. 추가 작업이 불필요합니다.
- 확인 과정에서 활성화되지 않은 계정임이 확인될 경우 전역 상태에 저장된 초대 코드가 있는지 확인합니다.
    - 존재하는 경우, 다음 단계로 속행합니다.
    - 존재하지 않는 경우, 로비 화면에서 초대 코드를 받는 Form이 보여지고 초대 코드를 사용자에게 입력받은 뒤 다음 단계로 속행합니다.
- 가지고 있는 초대 코드의 nonce를 확인하기 위해 `activationKeyNonce(invitationCode: $encodedActivationKey)` 쿼리를 실행합니다.
- 앞 과정에서 받은 nonce와 초대 코드, 임시로 쓸 파일의 위치를 Headless에 전달합니다. 이 과정에서 `ActivateAccount` 의 액션을 받습니다.
- 앞 과정에서 받은 액션을 Tx로 만들기 위해 Tx nonce를 받고 액션이 저장된 임시 파일의 위치와 nonce를 Headless에 전달하여 Tx를 받습니다.
- 이렇게 받은 Tx를 `stageTx` 뮤테이션으로 올립니다.
- 이후 1000ms마다 activate 상태를 체크하여 activation이 완료되었는지 확인합니다.
    - TODO: 더 나은 방법 고안

# 유의사항

- 계정 생성 중 입력된 초대 코드는 로비로 들어가기 전까지 어떤 영향도 끼치지 않습니다.

# 참고 자료

[초대 코드(Activation, a.k.a. 활성화키)](https://www.notion.so/Activation-a-k-a-e02c75ae1fad4567a8fcc402b60f5f6e)